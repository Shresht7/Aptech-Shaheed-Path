---
import Logo from "./Logo.astro";
import Navigation from "./Navigation.astro";
---

<header id="header">
    <div class="container wrapper">
        <Logo />
        <Navigation />
    </div>
    <div id="scroll-progress"></div>
</header>

<style>
    header {
        height: 10vh;
        position: sticky;
        top: 0;
        background-color: #ffffff55;
        backdrop-filter: blur(20px);
        z-index: 10;
    }

    .wrapper {
        height: 100%;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
    }

    #scroll-progress {
        --thickness: 2px;
        --offset: calc(100% - calc(var(--thickness) / 2));
        --color: var(--color-aptech-gold, red);
        --shadow: 0px -10px 40px 5px var(--color);

        position: absolute;
        height: var(--thickness, 3px);
        top: var(--offset);
        width: var(--scroll-progress, 10);
        background-color: var(--color);
        box-shadow: var(--shadow);
    }
</style>

<script>
    /** Total height of the page */
    const totalHeight =
        document.documentElement.scrollHeight -
        document.documentElement.clientHeight;

    /** Boolean flag that determines if the user is scrolling */
    let scrolling = false;

    /** Scroll progress ratio */
    let scrollProgress = 0;

    /** On-Scroll Handler Function */
    function onScrollUpdate(scrollProgress: number) {
        const header = document.getElementById("header")!;
        //  Update the CSS property to update progressbar width
        header.style.setProperty(
            "--scroll-progress",
            `${scrollProgress * 100}%`
        );
    }

    document.addEventListener("scroll", () => {
        //  Skip and return early if still processing the previous animation frame
        if (scrolling) {
            return;
        }

        window.requestAnimationFrame(() => {
            //  Calculate the scroll progress
            scrollProgress = window.scrollY / totalHeight;

            //  Call the on-scroll handler
            onScrollUpdate(scrollProgress);

            //  Unlock operation
            scrolling = false;
        });

        //  Lock operation
        scrolling = true;
    });
</script>
